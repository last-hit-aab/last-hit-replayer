{"version":3,"sources":["../lib/3rd-comps/support.ts"],"names":[],"mappings":"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","file":"support.js","sourcesContent":["import { Step } from 'last-hit-types';\nimport { ElementHandle, Page } from 'puppeteer';\nimport Select2 from './select2';\n\nexport type ElementRetriever = (element: ElementHandle) => Promise<string>;\nexport type ElementAttributeValueRetriever = (\n\telement: ElementHandle,\n\tattributeName: string\n) => Promise<string>;\nexport type ThirdStepSupportOptions = {\n\tpage: Page;\n\telement: ElementHandle;\n\ttagNameRetrieve: ElementRetriever;\n\telementTypeRetrieve: ElementRetriever;\n\tclassNamesRetrieve: ElementRetriever;\n\tattrValueRetrieve: ElementAttributeValueRetriever;\n\tsteps: Array<Step>;\n\tcurrentStepIndex: number;\n\tlogger: Console;\n};\n\nconst thirdParties = [new Select2()];\n\nclass ThirdStepSupport {\n\tprivate page: Page;\n\tprivate element: ElementHandle;\n\tprivate tagNameRetrieve: ElementRetriever;\n\tprivate elementTypeRetrieve: ElementRetriever;\n\tprivate classNamesRetrieve: ElementRetriever;\n\tprivate attrValueRetrieve: ElementAttributeValueRetriever;\n\tprivate steps: Array<Step>;\n\tprivate currentStepIndex: number;\n\tprivate logger: Console;\n\n\tconstructor(options: ThirdStepSupportOptions) {\n\t\tthis.page = options.page;\n\t\tthis.element = options.element;\n\t\tthis.tagNameRetrieve = options.tagNameRetrieve;\n\t\tthis.elementTypeRetrieve = options.elementTypeRetrieve;\n\t\tthis.classNamesRetrieve = options.classNamesRetrieve;\n\t\tthis.attrValueRetrieve = options.attrValueRetrieve;\n\t\tthis.steps = options.steps;\n\t\tthis.currentStepIndex = options.currentStepIndex;\n\t\tthis.logger = options.logger;\n\t}\n\tgetPage(): Page {\n\t\treturn this.page;\n\t}\n\tgetElement(): ElementHandle {\n\t\treturn this.element;\n\t}\n\tasync getTagName(): Promise<string> {\n\t\treturn await this.tagNameRetrieve(this.element);\n\t}\n\tasync getElementType(): Promise<string> {\n\t\treturn await this.elementTypeRetrieve(this.element);\n\t}\n\tasync getClassNames(): Promise<string> {\n\t\treturn await this.classNamesRetrieve(this.element);\n\t}\n\tasync getAttrValue(attrName: string): Promise<string> {\n\t\treturn await this.attrValueRetrieve(this.element, attrName);\n\t}\n\tgetSteps(): Array<Step> {\n\t\treturn this.steps;\n\t}\n\tgetCurrentStep(): Step {\n\t\treturn this.steps[this.getCurrentStepIndex()];\n\t}\n\tgetCurrentStepIndex(): number {\n\t\treturn this.currentStepIndex;\n\t}\n\tgetLogger(): Console {\n\t\treturn this.logger;\n\t}\n\t// step execution\n\tasync mousedown(): Promise<boolean> {\n\t\treturn await this.do('mousedown');\n\t}\n\tasync click(): Promise<boolean> {\n\t\treturn await this.do('click');\n\t}\n\tasync do(methodName: string): Promise<boolean> {\n\t\t// starts with a resolved promise\n\t\t// if any third-party support handled step execution, should return a resolved promise with true\n\t\t// otherwise return a resolved promise with false\n\t\t// any previous third-party support handled, ignored the left third-party supports\n\t\treturn await thirdParties.reduce(async (promise, third) => {\n\t\t\tconst done = await promise;\n\t\t\tif (done) {\n\t\t\t\treturn Promise.resolve(true);\n\t\t\t}\n\t\t\tif (third[methodName]) {\n\t\t\t\tconst done = await third[methodName](this);\n\t\t\t\tif (done) {\n\t\t\t\t\treturn Promise.resolve(true);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn Promise.resolve(false);\n\t\t}, Promise.resolve(false));\n\t}\n}\n\nexport default ThirdStepSupport;\n"]}