{"version":3,"sources":["../lib/replayer/replayer.ts"],"names":[],"mappings":"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","file":"replayer.js","sourcesContent":["import fs from 'fs';\nimport {\n\tExtensionBrowserOperationData,\n\tExtensionBrowserOperationEvent,\n\tExtensionErrorLogEvent,\n\tExtensionEventTypes,\n\tExtensionLogEvent,\n\tExtensionTestLogEvent,\n\tGetElementAttrValueData,\n\tGetElementPropValueData,\n\tWaitData,\n\tWaitForElementData\n} from 'last-hit-extensions';\nimport {\n\tAjaxStep,\n\tAnimationStep,\n\tChangeStep,\n\tClickStep,\n\tDevice,\n\tDialogCloseStep,\n\tDialogOpenStep,\n\tFlow,\n\tFlowParameter,\n\tFlowParameters,\n\tFocusStep,\n\tKeydownStep,\n\tMousedownStep,\n\tPageClosedStep,\n\tPageCreatedStep,\n\tPageSwitchStep,\n\tScrollStep,\n\tStartStep,\n\tStep,\n\tWorkspaceExtensions\n} from 'last-hit-types';\nimport path from 'path';\nimport puppeteer, { Browser, CoverageEntry, ElementHandle, Page, Request } from 'puppeteer';\nimport util from 'util';\nimport uuidv4 from 'uuid/v4';\nimport ThirdStepSupport, {\n\tElementAttributeValueRetriever,\n\tElementRetriever\n} from '../3rd-comps/support';\nimport Environment from '../config/env';\nimport { Summary } from '../types';\nimport { generateKeyByString, getTempFolder, inElectron, shorternUrl } from '../utils';\nimport ci from './ci-helper';\nimport compareScreenshot from './compare-screenshot';\nimport { controlPage } from './page-controller';\nimport ReplaySummary from './replay-summary';\nimport { WorkspaceExtensionRegistry } from './replayer-extension-registry';\nimport { ReplayerCache } from './replayers-cache';\nimport RequestCounter from './request-counter';\nimport ssim from './ssim';\nimport atob from 'atob';\n\nexport type ReplayerOptions = {\n\tstoryName: string;\n\tflow: Flow;\n\tenv: Environment;\n\tlogger: Console;\n\treplayers: ReplayerCache;\n\tregistry: WorkspaceExtensionRegistry;\n};\n\nconst getChromiumExecPath = () => {\n\treturn puppeteer.executablePath().replace('app.asar', 'app.asar.unpacked');\n};\n\nconst launchBrowser = async (\n\treplayer: Replayer,\n\tinput: WorkspaceExtensions.FlowParameterValues\n) => {\n\tlet step = replayer.getCurrentStep();\n\t// send step-should-start to extension, replace step when successfully return\n\tstep = await replayer\n\t\t.getRegistry()\n\t\t.stepShouldStart(replayer.getStoryName(), simplifyFlow(replayer.getFlow(), input), step);\n\n\tconst { url, device, uuid } = step as StartStep;\n\tconst {\n\t\tviewport: { width, height }\n\t} = device!;\n\tconst browserArgs: Array<string> = [];\n\tbrowserArgs.push(`--window-size=${width},${height + 150}`);\n\tbrowserArgs.push('--disable-infobars');\n\tbrowserArgs.push('--ignore-certificate-errors');\n\tbrowserArgs.push('--no-sandbox');\n\tbrowserArgs.push('--disable-extensions');\n\t// browserArgs.push('–-no-zygote')\n\n\tconst browser = await puppeteer.launch({\n\t\theadless: !inElectron,\n\t\texecutablePath: getChromiumExecPath(),\n\t\targs: browserArgs,\n\t\tdefaultViewport: null,\n\t\tslowMo: 20\n\t});\n\tconst pages = await browser.pages();\n\tlet page;\n\tif (pages != null && pages.length > 0) {\n\t\tpage = pages[0];\n\t} else {\n\t\tpage = await browser.newPage();\n\t}\n\t// set back to replayer\n\treplayer.setBrowser(browser);\n\treplayer.putPage(uuid, page, true);\n\treplayer.setDevice(device!);\n\t// add control into page\n\tawait controlPage(replayer, page, device!, uuid);\n\t// open url, timeout to 2 mins\n\tawait page.goto(url, { waitUntil: 'domcontentloaded', timeout: 120000 });\n\n\t// RESEARCH waste too much time, remove\n\t// try {\n\t// \tawait page.waitForNavigation();\n\t// } catch (e) {\n\t// \tlogger.error(e);\n\t// }\n\n\t// you can try this solution about wait for navigateion\n\t/*\n\tconst [response] = await Promise.all([\n\t\tpage.waitForNavigation(), // The promise resolves after navigation has finished\n\t\tawait page.goto(step.url, { waitUntil: 'domcontentloaded' }), // Go to the url will indirectly cause a navigation\n\t]);\n\t*/\n\t// send step-accomplished to extension\n\t// accomplished only triggerred when step has not error on replaying\n\tconst accomplishedStep = await replayer\n\t\t.getRegistry()\n\t\t.stepAccomplished(replayer.getStoryName(), simplifyFlow(replayer.getFlow(), input), step);\n\tif (!accomplishedStep._.passed) {\n\t\t// extension says failed\n\t\tthrow accomplishedStep._.error!;\n\t}\n\treturn page;\n};\n\nconst simplifyFlow = (\n\tflow: Flow,\n\tinput?: WorkspaceExtensions.FlowParameterValues\n): WorkspaceExtensions.SimpleFlow => {\n\tconst { name, description, params } = flow;\n\treturn {\n\t\tname,\n\t\tdescription,\n\t\tparams: !input\n\t\t\t? params\n\t\t\t: (Object.keys(input).map(key => {\n\t\t\t\t\treturn { name: key, type: 'in', value: input[key] } as FlowParameter;\n\t\t\t  }) as FlowParameters)\n\t};\n};\n\nclass Replayer {\n\tprivate storyName: string;\n\tprivate flow: Flow;\n\n\tprivate device: Device | null = null;\n\n\tprivate browser: Browser | null = null;\n\t/** key is uuid, value is page */\n\tprivate pages: { [key in string]: Page } = {};\n\tprivate currentIndex: number = 0;\n\t/** key is uuid, value is request counter */\n\tprivate requests: { [key in string]: RequestCounter } = {};\n\n\tprivate summary: ReplaySummary;\n\tprivate coverages: Array<CoverageEntry> = [];\n\n\t/** true when switch to record, never turn back to false again */\n\tprivate onRecord: boolean = false;\n\tprivate logger: Console;\n\tprivate replayers: ReplayerCache;\n\tprivate env: Environment;\n\n\tprivate registry: WorkspaceExtensionRegistry;\n\tprivate flowInput: WorkspaceExtensions.FlowParameterValues = {};\n\tprivate flowOutput: WorkspaceExtensions.FlowParameterValues = {};\n\tprivate testLogs: Array<{\n\t\ttitle: string;\n\t\tpassed: boolean;\n\t\tlevel: number;\n\t\tmessage?: string;\n\t}> = [];\n\n\tconstructor(options: ReplayerOptions) {\n\t\tconst { storyName, flow, env, logger, replayers, registry } = options;\n\t\tthis.storyName = storyName;\n\t\tthis.flow = (() => {\n\t\t\tconst { steps = [] as Step[], ...rest } = flow;\n\t\t\treturn {\n\t\t\t\t...rest,\n\t\t\t\tsteps: steps.map((step: Step) => env.wrap(step))\n\t\t\t};\n\t\t})();\n\t\tthis.logger = logger;\n\t\tthis.summary = new ReplaySummary({ storyName, flow, env });\n\t\tthis.replayers = replayers;\n\t\tthis.env = env;\n\t\tthis.registry = registry;\n\t\tthis.registry\n\t\t\t.on(ExtensionEventTypes.LOG, this.handleExtensionLog)\n\t\t\t.on(ExtensionEventTypes.ERROR_LOG, this.handleExtensionErrorLog)\n\t\t\t.on(ExtensionEventTypes.BROWSER_OPERATION, this.handlerBrowserOperation)\n\t\t\t.on(ExtensionEventTypes.TEST_LOG, this.handleTestLog);\n\t}\n\tprivate handleExtensionLog = (event: ExtensionLogEvent): void => {\n\t\tthis.getLogger().log(event);\n\t};\n\tprivate handleExtensionErrorLog = (event: ExtensionErrorLogEvent): void => {\n\t\tthis.getLogger().error(event);\n\t};\n\tprivate handlerBrowserOperation = (event: ExtensionBrowserOperationEvent): void => {\n\t\tconst { data } = event;\n\t\tswitch ((data as ExtensionBrowserOperationData).type) {\n\t\t\tcase 'get-element-attr-value':\n\t\t\t\tthis.tryToGetElementAttrValue(data as GetElementAttrValueData);\n\t\t\t\tbreak;\n\t\t\tcase 'get-element-prop-value':\n\t\t\t\tthis.tryToGetElementPropValue(data as GetElementPropValueData);\n\t\t\t\tbreak;\n\t\t\tcase 'wait':\n\t\t\t\tthis.tryToWait(data as WaitData);\n\t\t\t\tbreak;\n\t\t\tcase 'wait-element':\n\t\t\t\tthis.tryToWaitForElement(data as WaitForElementData);\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tconst registry = this.getRegistry();\n\t\t\t\tregistry.sendBrowserOperation(registry.getWorkspaceExtensionId(), null);\n\t\t}\n\t};\n\tprivate handleTestLog = (event: ExtensionTestLogEvent): void => {\n\t\t// console.log(event);\n\t\tthis.testLogs.push(event.data);\n\t};\n\tprivate getFlowInput(): WorkspaceExtensions.FlowParameterValues {\n\t\treturn this.flowInput;\n\t}\n\tprivate getFlowOutput(): WorkspaceExtensions.FlowParameterValues {\n\t\treturn this.flowOutput;\n\t}\n\tprivate getTestLogs() {\n\t\treturn this.testLogs;\n\t}\n\tprivate async findCurrentPage(uuid?: string): Promise<Page> {\n\t\tif (uuid) {\n\t\t\tconst page = this.getPage(uuid);\n\t\t\tif (!page) {\n\t\t\t\tthrow new Error(`page[${uuid}] not found`);\n\t\t\t}\n\t\t\treturn page;\n\t\t} else {\n\t\t\t// uuid not given, try to get first one\n\t\t\tconst pages = await this.getBrowser()!.pages();\n\t\t\tif (pages.length === 0) {\n\t\t\t\tthrow new Error(`No page now`);\n\t\t\t} else {\n\t\t\t\treturn pages[0];\n\t\t\t}\n\t\t}\n\t}\n\tprivate async tryToGetElementAttrValue(data: GetElementAttrValueData): Promise<void> {\n\t\tconst { csspath, attrName, pageUuid } = data;\n\t\tconst registry = this.getRegistry();\n\n\t\ttry {\n\t\t\tconst page = await this.findCurrentPage(pageUuid);\n\t\t\tconst element = await page.$(csspath);\n\t\t\tif (!element) {\n\t\t\t\tthrow new Error(`element[${csspath}] not found`);\n\t\t\t}\n\t\t\tconst value = await element.evaluate(\n\t\t\t\t(node, attrName: string) => node.getAttribute(attrName),\n\t\t\t\tattrName\n\t\t\t);\n\t\t\tregistry.sendBrowserOperation(registry.getWorkspaceExtensionId(), value);\n\t\t} catch (e) {\n\t\t\tregistry.sendBrowserOperation(registry.getWorkspaceExtensionId(), e);\n\t\t}\n\t}\n\tprivate async tryToGetElementPropValue(data: GetElementPropValueData): Promise<void> {\n\t\tconst { csspath, propName, pageUuid } = data;\n\t\tconst registry = this.getRegistry();\n\n\t\ttry {\n\t\t\tconst page = await this.findCurrentPage(pageUuid);\n\t\t\tconst element = await page.$(csspath);\n\t\t\tif (!element) {\n\t\t\t\tthrow new Error(`element[${csspath}] not found`);\n\t\t\t}\n\t\t\tconst value = await element.evaluate(\n\t\t\t\t(node, propName: string) => node[propName],\n\t\t\t\tpropName\n\t\t\t);\n\t\t\tregistry.sendBrowserOperation(registry.getWorkspaceExtensionId(), value);\n\t\t} catch (e) {\n\t\t\tregistry.sendBrowserOperation(registry.getWorkspaceExtensionId(), e);\n\t\t}\n\t}\n\tprivate async tryToWait(data: WaitData): Promise<void> {\n\t\tconst { time } = data;\n\t\tconst wait = util.promisify(setTimeout);\n\t\tawait wait(time);\n\t\tconst registry = this.getRegistry();\n\t\tregistry.sendBrowserOperation(registry.getWorkspaceExtensionId(), null);\n\t}\n\tprivate async tryToWaitForElement(data: WaitForElementData): Promise<void> {\n\t\tconst {\n\t\t\tcsspath,\n\t\t\ttime,\n\t\t\tpageUuid,\n\t\t\toptions: { visible = false, hidden = false } = { visible: false, hidden: false }\n\t\t} = data;\n\t\tconst registry = this.getRegistry();\n\n\t\ttry {\n\t\t\tconst page = await this.findCurrentPage(pageUuid);\n\t\t\tawait page.waitForSelector(csspath, { visible, hidden, timeout: time });\n\t\t\tregistry.sendBrowserOperation(registry.getWorkspaceExtensionId(), null);\n\t\t} catch (e) {\n\t\t\tregistry.sendBrowserOperation(registry.getWorkspaceExtensionId(), e);\n\t\t}\n\t}\n\tgetRegistry(): WorkspaceExtensionRegistry {\n\t\treturn this.registry;\n\t}\n\tswitchToRecord(): Browser {\n\t\tthis.onRecord = true;\n\t\treturn this.browser!;\n\t}\n\tisOnRecord(): boolean {\n\t\treturn this.onRecord;\n\t}\n\tgetLogger(): Console {\n\t\treturn this.logger;\n\t}\n\tprivate getEnvironment() {\n\t\treturn this.env;\n\t}\n\tgetStoryName(): string {\n\t\treturn this.storyName;\n\t}\n\tgetFlow(): Flow {\n\t\treturn this.flow;\n\t}\n\tgetIdentity(): string {\n\t\treturn generateKeyByString(this.getStoryName(), this.getFlow().name);\n\t}\n\t/**\n\t * @returns summary object\n\t */\n\tgetSummary(): ReplaySummary {\n\t\treturn this.summary;\n\t}\n\tgetSummaryData(): Summary {\n\t\treturn this.summary.getSummary();\n\t}\n\tgetCoverageData() {\n\t\treturn this.coverages;\n\t}\n\tgetSteps(): Array<Step> {\n\t\treturn this.flow.steps || [];\n\t}\n\tgetCurrentIndex(): number {\n\t\treturn this.currentIndex;\n\t}\n\tgetCurrentStep(): Step {\n\t\treturn this.getSteps()[this.getCurrentIndex()];\n\t}\n\t/**\n\t * @returns null only if not start\n\t */\n\tgetBrowser(): Browser | null {\n\t\treturn this.browser;\n\t}\n\tsetBrowser(browser: Browser): void {\n\t\tthis.browser = browser;\n\t}\n\tgetDevice(): Device | null {\n\t\treturn this.device;\n\t}\n\tsetDevice(device: Device): void {\n\t\tthis.device = device;\n\t}\n\tfindUuid(page: Page): string | undefined {\n\t\treturn Object.keys(this.pages).find(id => this.pages[id] === page);\n\t}\n\tgetPage(uuid: string): Page | null {\n\t\treturn this.pages[uuid];\n\t}\n\t/**\n\t * get page by given uuid, throw error when not found\n\t */\n\tasync getPageOrThrow(uuid: string): Promise<Page> {\n\t\tconst page = this.getPage(uuid);\n\t\tif (page == null) {\n\t\t\tthrow new Error('Page not found.');\n\t\t}\n\t\tawait page.bringToFront();\n\t\treturn page;\n\t}\n\t/**\n\t * sometimes page speed is very slow, the page-create, page-switch, popup events are not always in correct order on recording.\n\t *\n\t * @param force force close exists page when true, force close myself when false\n\t * @returns true when successfully put, false means given page has been closed forcely\n\t */\n\tputPage(uuid: string, page: Page, force: boolean): boolean {\n\t\tif (this.pages[uuid] != null) {\n\t\t\t// already exists\n\t\t\tif (force) {\n\t\t\t\t// force is true means given is from popup, then exists is from page-created or page-switched\n\t\t\t\t// force close exists and put given to cache\n\t\t\t\tconst exists = this.pages[uuid];\n\t\t\t\tdelete this.pages[uuid];\n\t\t\t\tdelete this.requests[uuid];\n\t\t\t\texists.close();\n\t\t\t\tthis.pages[uuid] = page;\n\t\t\t\tthis.requests[uuid] = new RequestCounter(page, this.getSummary(), this.getLogger());\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\t// force is true means given is from page-created or page-switched, then force close given itself\n\t\t\t\t// keep cache\n\t\t\t\tpage.close();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} else {\n\t\t\t// not found, put into cache\n\t\t\tthis.pages[uuid] = page;\n\t\t\tthis.requests[uuid] = new RequestCounter(page, this.getSummary(), this.getLogger());\n\t\t\treturn true;\n\t\t}\n\t}\n\t/**\n\t * @return removed page or null if not exists\n\t */\n\tremovePage(uuidOrPage: string | Page): string | Page | null {\n\t\tif (typeof uuidOrPage === 'string') {\n\t\t\tconst page = this.pages[uuidOrPage];\n\t\t\tdelete this.pages[uuidOrPage];\n\t\t\tdelete this.requests[uuidOrPage];\n\t\t\treturn page;\n\t\t} else {\n\t\t\tconst uuid = this.findUuid(uuidOrPage)!;\n\t\t\tdelete this.pages[uuid];\n\t\t\tdelete this.requests[uuid];\n\t\t\treturn uuidOrPage;\n\t\t}\n\t}\n\tputRequest(uuid: string, request: Request): void {\n\t\tconst requests = this.requests[uuid];\n\t\tif (requests) {\n\t\t\tthis.requests[uuid].create(request);\n\t\t}\n\t}\n\toffsetRequest(uuid: string, request: Request, success: boolean): void {\n\t\tconst requests = this.requests[uuid];\n\t\tif (requests) {\n\t\t\trequests.offset(request, success);\n\t\t}\n\t}\n\tprivate async isRemoteFinsihed(page: Page): Promise<void> {\n\t\tconst uuid = this.findUuid(page)!;\n\t\tconst requests = this.requests[uuid];\n\t\t// return requests.waitForAllDone();\n\n\t\t// peep next step, if not ajax step, resolve directly to speed up\n\t\tconst { type } = this.getCurrentStep();\n\t\tif (['page-switched', 'page-created'].includes(type)) {\n\t\t\treturn requests.waitForAllDone();\n\t\t}\n\t\tif (['scroll'].includes(type)) {\n\t\t\treturn new Promise(resolve => setTimeout(resolve, 30));\n\t\t}\n\n\t\tconst currentStepIndex = this.getCurrentIndex();\n\t\tconst nextStep = this.getSteps()[currentStepIndex + 1];\n\t\tif (nextStep && nextStep.type === 'ajax') {\n\t\t\treturn requests.waitForAllDone();\n\t\t} else {\n\t\t\t// wait for several milliseconds, maybe there is some animation or dom changes\n\t\t\treturn new Promise(resolve => setTimeout(resolve, 30));\n\t\t}\n\t}\n\tprivate async sleepAfterStep(step: Step): Promise<void> {\n\t\tconst sleep = step.sleep;\n\t\tif (sleep && sleep > 0) {\n\t\t\tconst wait = util.promisify(setTimeout);\n\t\t\tawait wait(sleep);\n\t\t}\n\t}\n\tprivate async prepareFlow(): Promise<void> {\n\t\tconst preparedFlow: WorkspaceExtensions.PreparedFlow | null = await this.getRegistry().flowShouldStart(\n\t\t\tthis.getStoryName(),\n\t\t\tsimplifyFlow(this.getFlow())\n\t\t);\n\t\tconst { _: { input = {} } = { input: {} } } = preparedFlow || { _: { input: {} } };\n\t\tif (Object.keys(input).length === 0) {\n\t\t\t// no input given by scripts\n\t\t\t// use definition\n\t\t\tconst { params = [] } = this.getFlow();\n\t\t\tthis.flowInput = params\n\t\t\t\t.filter(param => ['in', 'both'].includes(param.type))\n\t\t\t\t.reduce((input, param) => {\n\t\t\t\t\tinput[param.name] = param.value;\n\t\t\t\t\treturn input;\n\t\t\t\t}, {} as WorkspaceExtensions.FlowParameterValues);\n\t\t} else {\n\t\t\tthis.flowInput = input;\n\t\t}\n\t}\n\tasync start() {\n\t\t// TODO how to use prepared story? currently ignored\n\t\tconst preparedStory: WorkspaceExtensions.PreparedStory = await this.getRegistry().prepareStory(\n\t\t\tthis.getStoryName()\n\t\t);\n\t\tawait this.prepareFlow();\n\n\t\tconst page = await launchBrowser(this, this.getFlowInput());\n\t\tawait this.isRemoteFinsihed(page);\n\t}\n\tprivate async accomplishFlow(): Promise<void> {\n\t\tconst accomplishedFlow: WorkspaceExtensions.AccomplishedFlow | null = await this.getRegistry().flowAccomplished(\n\t\t\tthis.getStoryName(),\n\t\t\t(() => {\n\t\t\t\tconst flow = simplifyFlow(this.getFlow());\n\t\t\t\tlet { params = [] } = flow;\n\t\t\t\t// clone\n\t\t\t\tparams = JSON.parse(JSON.stringify(params));\n\t\t\t\tconst input = this.getFlowInput() || {};\n\t\t\t\t// put instance data into params, and pass to extension\n\t\t\t\tObject.keys(input).forEach(key => {\n\t\t\t\t\tconst param = params.find(param => param.name === key);\n\t\t\t\t\tif (!param) {\n\t\t\t\t\t\tparams.push({ name: key, type: 'in', value: input[key] } as FlowParameter);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tparam.value = input[key];\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\tflow.params = params;\n\t\t\t\treturn flow;\n\t\t\t})()\n\t\t);\n\t\tconst { _: { output = {} } = { output: {} } } = accomplishedFlow || { _: { output: {} } };\n\t\tif (Object.keys(output).length === 0) {\n\t\t\t// no output given by scripts\n\t\t\t// read out/both from flow input\n\t\t\tconst { params = [] } = this.getFlow();\n\t\t\tthis.flowOutput = params\n\t\t\t\t.filter(param => ['out', 'both'].includes(param.type))\n\t\t\t\t.reduce((output, param) => {\n\t\t\t\t\toutput[param.name] = this.flowInput[param.name];\n\t\t\t\t\tif (typeof output[param.name] === 'undefined') {\n\t\t\t\t\t\t// not found in flow input, find in definition\n\t\t\t\t\t\toutput[param.name] = param.value;\n\t\t\t\t\t}\n\t\t\t\t\treturn output;\n\t\t\t\t}, {} as WorkspaceExtensions.FlowParameterValues);\n\t\t} else {\n\t\t\tthis.flowOutput = output;\n\t\t}\n\t}\n\t/**\n\t * only called in CI\n\t */\n\tasync end(close: boolean): Promise<void> {\n\t\tconst browser = this.getBrowser();\n\t\tif (browser == null) {\n\t\t\t// do nothing, seems not start\n\t\t} else {\n\t\t\tawait this.accomplishFlow();\n\t\t\tthis.getSummary().handleFlowParameters(this.getFlowInput(), this.getFlowOutput());\n\t\t\tthis.getSummary().handleScriptTests(this.getTestLogs());\n\t\t\ttry {\n\t\t\t\tconst pages = await browser.pages();\n\t\t\t\tthis.coverages = await ci.gatherCoverage(pages);\n\t\t\t\tbrowser.disconnect();\n\t\t\t} catch (e) {\n\t\t\t\tthis.getLogger().error('Failed to disconnect from brwoser.');\n\t\t\t\tthis.getLogger().error(e);\n\t\t\t}\n\t\t\tif (close) {\n\t\t\t\ttry {\n\t\t\t\t\tawait browser.close();\n\t\t\t\t\tdelete this.replayers[this.getIdentity()];\n\t\t\t\t} catch (e) {\n\t\t\t\t\tthis.getLogger().error('Failed to close browser.');\n\t\t\t\t\tthis.getLogger().error(e);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\tthis.registry\n\t\t\t.off(ExtensionEventTypes.LOG, this.handleExtensionLog)\n\t\t\t.off(ExtensionEventTypes.ERROR_LOG, this.handleExtensionErrorLog);\n\t}\n\tprivate replaceWithFlowParams(step: Step): Step {\n\t\tconst newStep = { ...step } as any;\n\n\t\t['value'].forEach(propName => {\n\t\t\tconst value = step[propName];\n\t\t\tif (!value || typeof value !== 'string') {\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tconst flowInput = this.getFlowInput();\n\t\t\tnewStep[propName] = Object.keys(flowInput).reduce((value, key) => {\n\t\t\t\treturn value.replace(`\\${${key}}`, `${flowInput[key] || ''}`);\n\t\t\t}, value);\n\t\t});\n\n\t\treturn newStep as Step;\n\t}\n\t/**\n\t * do next step\n\t */\n\tasync next(flow: Flow, index: number, storyName: string) {\n\t\tthis.flow = flow;\n\t\tthis.currentIndex = index;\n\t\tlet step: Step = this.getCurrentStep();\n\t\tif (step.type === 'end') {\n\t\t\treturn;\n\t\t}\n\n\t\tstep = this.replaceWithFlowParams(step);\n\n\t\ttry {\n\t\t\t// send step-should-start to extension, replace step when successfully return\n\t\t\tstep = await this.getRegistry().stepShouldStart(\n\t\t\t\tthis.getStoryName(),\n\t\t\t\tsimplifyFlow(this.getFlow(), this.getFlowInput()),\n\t\t\t\tstep\n\t\t\t);\n\n\t\t\tconst ret = await (async () => {\n\t\t\t\tswitch (step.type) {\n\t\t\t\t\tcase 'change':\n\t\t\t\t\t\treturn await this.executeChangeStep(step as ChangeStep);\n\t\t\t\t\tcase 'click':\n\t\t\t\t\t\treturn await this.executeClickStep(step as ClickStep);\n\t\t\t\t\tcase 'focus':\n\t\t\t\t\t\treturn await this.executeFocusStep(step as FocusStep);\n\t\t\t\t\tcase 'keydown':\n\t\t\t\t\t\treturn await this.executeKeydownStep(step as KeydownStep);\n\t\t\t\t\tcase 'mousedown':\n\t\t\t\t\t\treturn await this.executeMousedownStep(step as MousedownStep);\n\t\t\t\t\tcase 'animation':\n\t\t\t\t\t\treturn await this.executeAnimationStep(step as AnimationStep);\n\t\t\t\t\tcase 'ajax':\n\t\t\t\t\t\treturn await (async () => {\n\t\t\t\t\t\t\tawait this.executeAjaxStep(step as AjaxStep);\n\t\t\t\t\t\t\treturn Promise.resolve({ wait: false });\n\t\t\t\t\t\t})();\n\t\t\t\t\tcase 'scroll':\n\t\t\t\t\t\treturn await this.executeScrollStep(step as ScrollStep);\n\t\t\t\t\tcase 'dialog-open':\n\t\t\t\t\t\treturn await this.executeDialogOpenStep(step as DialogOpenStep);\n\t\t\t\t\tcase 'dialog-close':\n\t\t\t\t\t\treturn await this.executeDialogCloseStep(step as DialogCloseStep);\n\t\t\t\t\tcase 'page-created':\n\t\t\t\t\t\treturn await this.executePageCreatedStep(step as PageCreatedStep);\n\t\t\t\t\tcase 'page-switched':\n\t\t\t\t\t\treturn await this.executePageSwitchedStep(step as PageSwitchStep);\n\t\t\t\t\tcase 'page-closed':\n\t\t\t\t\t\treturn await (async () => {\n\t\t\t\t\t\t\tawait this.executePageClosedStep(step as PageClosedStep);\n\t\t\t\t\t\t\treturn Promise.resolve({ wait: false });\n\t\t\t\t\t\t})();\n\t\t\t\t\tcase 'end':\n\t\t\t\t\t\treturn Promise.resolve({ wait: false });\n\t\t\t\t\tdefault:\n\t\t\t\t\t\tthis.getLogger().log(`Step[${step.type}] is not implemented yet.`);\n\t\t\t\t\t\treturn Promise.resolve();\n\t\t\t\t}\n\t\t\t})();\n\n\t\t\tconst page = this.getPage(step.uuid);\n\t\t\tif ((!ret || ret.wait !== false) && page != null) {\n\t\t\t\t// const page = await this.getPageOrThrow(step.uuid);\n\t\t\t\tawait this.isRemoteFinsihed(page);\n\t\t\t}\n\t\t\tawait this.sleepAfterStep(step);\n\n\t\t\tif (step.image && page != null && !page.isClosed()) {\n\t\t\t\tconst screenshotPath = path.join(getTempFolder(process.cwd())!, 'screen-record');\n\t\t\t\tif (!fs.existsSync(screenshotPath)) {\n\t\t\t\t\tfs.mkdirSync(screenshotPath, { recursive: true });\n\t\t\t\t}\n\n\t\t\t\tconst flowPath = path.join(screenshotPath, storyName, flow.name);\n\t\t\t\tif (!fs.existsSync(flowPath)) {\n\t\t\t\t\tfs.mkdirSync(flowPath, { recursive: true });\n\t\t\t\t}\n\n\t\t\t\tconst replayImage = await page.screenshot({ encoding: 'base64' });\n\t\t\t\tconst replayImageFilename = path.join(flowPath, step.stepUuid + '_replay.png');\n\t\t\t\tfs.writeFileSync(replayImageFilename, Buffer.from(replayImage, 'base64'));\n\t\t\t\tconst currentImageFilename = path.join(flowPath, step.stepUuid + '_baseline.png');\n\t\t\t\tfs.writeFileSync(currentImageFilename, Buffer.from(step.image, 'base64'));\n\n\t\t\t\tconst ssimData = await ssim(currentImageFilename, replayImageFilename);\n\t\t\t\tif (ssimData.ssim < 0.96 || ssimData.mcs < 0.96) {\n\t\t\t\t\tconst diffImage = compareScreenshot(step.image, replayImage);\n\t\t\t\t\tconst diffImageFilename = path.join(flowPath, step.stepUuid + '_diff.png');\n\t\t\t\t\tdiffImage.onComplete((data: any) => {\n\t\t\t\t\t\tthis.getSummary().compareScreenshot(step);\n\t\t\t\t\t\tdata.getDiffImage()\n\t\t\t\t\t\t\t.pack()\n\t\t\t\t\t\t\t.pipe(fs.createWriteStream(diffImageFilename));\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\t// console.error(e);\n\t\t\tawait this.handleStepError(step, e);\n\n\t\t\t// send step-on-error to extension\n\t\t\tconst stepOnError = await this.getRegistry().stepOnError(\n\t\t\t\tthis.getStoryName(),\n\t\t\t\tsimplifyFlow(this.getFlow(), this.getFlowInput()),\n\t\t\t\tstep,\n\t\t\t\te\n\t\t\t);\n\t\t\tif (!stepOnError._.fixed) {\n\t\t\t\t// extension says not fixed, throw error\n\t\t\t\tthrow e;\n\t\t\t} else {\n\t\t\t\t// extension says fixed, ignore error and continue replay\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// send step-accomplished to extension\n\t\t// accomplished only triggerred when step has not error on replaying\n\t\ttry {\n\t\t\tconst accomplishedStep = await this.getRegistry().stepAccomplished(\n\t\t\t\tthis.getStoryName(),\n\t\t\t\tsimplifyFlow(this.getFlow(), this.getFlowInput()),\n\t\t\t\tstep\n\t\t\t);\n\t\t\tif (!accomplishedStep._.passed) {\n\t\t\t\t// extension says failed\n\t\t\t\tthrow accomplishedStep._.error ||\n\t\t\t\t\tnew Error(`Fail on step cause by step accomplished extension.`);\n\t\t\t}\n\t\t} catch (e) {\n\t\t\tawait this.handleStepError(step, e);\n\t\t\tthrow e;\n\t\t}\n\t}\n\tprivate async handleStepError(step: Step, e: any) {\n\t\tconst page = this.getPage(step.uuid);\n\t\tthis.getSummary().handleError(step, e);\n\t\tconst errorFile = `${getTempFolder(process.cwd())}/error-${step.stepUuid}.png`;\n\t\tif (page) {\n\t\t\tawait page.screenshot({ path: errorFile, type: 'png' });\n\t\t} else {\n\t\t\tthis.getLogger().log(\"page don't exsit \");\n\t\t}\n\t}\n\tprivate async executeChangeStep(step: ChangeStep): Promise<void> {\n\t\tconst page = await this.getPageOrThrow(step.uuid);\n\t\tconst xpath = this.transformStepPathToXPath(step.path);\n\t\tthis.getLogger().log(`Execute change, step path is ${xpath}, step value is ${step.value}.`);\n\n\t\tconst element = await this.findElement(step, page);\n\t\tconst elementTagName = await this.getElementTagName(element);\n\t\tconst elementType = await this.getElementType(element);\n\n\t\tlet isFileUpload = false;\n\t\tif (elementTagName === 'INPUT') {\n\t\t\tif (elementType === 'file') {\n\t\t\t\tisFileUpload = true;\n\t\t\t}\n\t\t}\n\n\t\tif (isFileUpload) {\n\t\t\tconst value = step.value!;\n\t\t\tlet segments = value.split('\\\\');\n\t\t\tsegments = segments[segments.length - 1].split('/');\n\t\t\tconst filename = segments[segments.length - 1];\n\t\t\tconst dir = path.join(getTempFolder(process.cwd())!, 'upload-temp', uuidv4());\n\t\t\tconst filepath = path.join(dir, filename);\n\t\t\tconst byteString = atob(step.file!.split(',')[1]);\n\n\t\t\t// write the bytes of the string to an ArrayBuffer\n\t\t\tconst ab = new ArrayBuffer(byteString.length);\n\t\t\t// create a view into the buffer\n\t\t\tconst ia = new Uint8Array(ab);\n\t\t\t// set the bytes of the buffer to the correct values\n\t\t\tfor (let i = 0; i < byteString.length; i++) {\n\t\t\t\tia[i] = byteString.charCodeAt(i);\n\t\t\t}\n\t\t\t// write the ArrayBuffer to a blob, and you're done\n\t\t\tfs.mkdirSync(dir, { recursive: true });\n\t\t\tfs.writeFileSync(filepath, Buffer.from(ia));\n\n\t\t\t// file upload\n\t\t\tconst [fileChooser] = await Promise.all([\n\t\t\t\tpage.waitForFileChooser(),\n\t\t\t\telement.evaluate((node: Element) => (node as HTMLElement).click())\n\t\t\t]);\n\t\t\tawait fileChooser.accept([filepath]);\n\t\t} else {\n\t\t\t// change is change only, cannot use type\n\t\t\tawait this.setValueToElement(element, step.value!);\n\n\t\t\tconst env = this.getEnvironment();\n\t\t\tif (env.getSleepAfterChange()) {\n\t\t\t\tconst wait = util.promisify(setTimeout);\n\t\t\t\tawait wait(env.getSleepAfterChange()!);\n\t\t\t}\n\t\t\tif (step.forceBlur) {\n\t\t\t\tawait element.evaluate((node: Element) => {\n\t\t\t\t\t(node as any).focus && (node as HTMLElement).focus();\n\t\t\t\t\tconst event = document.createEvent('HTMLEvents');\n\t\t\t\t\tevent.initEvent('blur', true, true);\n\t\t\t\t\tnode.dispatchEvent(event);\n\t\t\t\t});\n\t\t\t}\n\t\t}\n\t}\n\tprivate async executeClickStep(step: ClickStep): Promise<void> {\n\t\tconst page = await this.getPageOrThrow(step.uuid);\n\t\tconst xpath = this.transformStepPathToXPath(step.path);\n\t\tthis.getLogger().log(`Execute click, step path is ${xpath}.`);\n\n\t\tconst element = await this.findElement(step, page);\n\t\tconst elementTagName = await this.getElementTagName(element);\n\n\t\tif ((step.csspath || '').startsWith('#last-hit-wechat-share')) {\n\t\t\t// wechat update share data may have delay time\n\t\t\t// according to experience, delay time might be 1000-5000ms\n\t\t\t// when detect the share button click, force wait for 5000ms, wait the share data updated if exists\n\t\t\tconst wait = util.promisify(setTimeout);\n\t\t\tawait wait(5000);\n\t\t\tawait element.click();\n\t\t\treturn;\n\t\t}\n\n\t\tconst support = this.createThirdStepSupport(page, element);\n\t\tconst done = await support.click();\n\t\tif (done) {\n\t\t\treturn;\n\t\t}\n\n\t\tif (elementTagName === 'INPUT') {\n\t\t\tconst elementType = await this.getElementType(element);\n\t\t\tif (elementType && ['checkbox', 'radio'].includes(elementType.toLowerCase())) {\n\t\t\t\t// there are some ui-repos, show a div/span/i etc instead of checkbox itself\n\t\t\t\t// and invoke click event by javascript when user click the visible component\n\t\t\t\t// it will causes record the click and change event\n\t\t\t\t// anyway replay change only changes the value of input, it's unaffected.\n\t\t\t\t// but the click leads value changing.\n\t\t\t\t// so here is the check, if value and checked are already same as which did by the click step, ignore the click step.\n\t\t\t\tconst value = await this.getElementValue(element);\n\t\t\t\tconst checked = await this.getElementChecked(element);\n\t\t\t\tif (value == step.value && checked == step.checked) {\n\t\t\t\t\t// ignore this click, the value and checked is already same as step does\n\t\t\t\t\tthis.getLogger().log(\n\t\t\t\t\t\t'Click excution is ignored because of value and checked are matched, it was invoked by javascript or something else already.'\n\t\t\t\t\t);\n\t\t\t\t\treturn;\n\t\t\t\t}\n\t\t\t} else if (elementType === 'file') {\n\t\t\t\t// click on a input[type=file] will introduce a file chooser dialog\n\t\t\t\t// which cannot be resolved programatically\n\t\t\t\t// ignore it\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\t\tconst visible = await this.isElementVisible(element);\n\t\tif (visible) {\n\t\t\tawait element.click();\n\t\t} else {\n\t\t\tawait element.evaluate((node: Element) => (node as HTMLElement).click());\n\t\t}\n\t}\n\tprivate async executeFocusStep(step: FocusStep): Promise<void> {\n\t\tconst page = await this.getPageOrThrow(step.uuid);\n\t\tconst xpath = this.transformStepPathToXPath(step.path);\n\t\tthis.getLogger().log(`Execute focus, step path is ${xpath}.`);\n\n\t\tconst element = await this.findElement(step, page);\n\t\tawait element.evaluate((node: Element) => {\n\t\t\t(node as any).focus && (node as HTMLElement).focus();\n\t\t\tconst event = document.createEvent('HTMLEvents');\n\t\t\tevent.initEvent('focus', true, true);\n\t\t\tnode.dispatchEvent(event);\n\t\t});\n\t}\n\tprivate async executeKeydownStep(step: KeydownStep): Promise<void> {\n\t\tconst page = await this.getPageOrThrow(step.uuid);\n\t\tconst xpath = this.transformStepPathToXPath(step.path);\n\t\tconst value = step.value;\n\t\tthis.getLogger().log(`Execute keydown, step path is ${xpath}, key is ${value}`);\n\n\t\tconst steps = this.getSteps();\n\t\tconst currentIndex = this.getCurrentIndex();\n\n\t\t// check the pattern: keydown(key=enter)->change->click(element type=submit)\n\t\tif (steps[currentIndex + 1].type === 'change') {\n\t\t\tif (step.target === (steps[currentIndex + 1] as ChangeStep).target) {\n\t\t\t\tif (steps[currentIndex + 2].type === 'click') {\n\t\t\t\t\tconst element = await this.findElement(steps[currentIndex + 2], page);\n\t\t\t\t\tconst elementTagName = await this.getElementTagName(element);\n\t\t\t\t\tconst elementType = await this.getElementType(element);\n\t\t\t\t\tif (elementTagName === 'INPUT' && elementType === 'submit') {\n\t\t\t\t\t\tthis.getLogger().debug(\n\t\t\t\t\t\t\t`find the pattern: enter->change->submit, then skip the enter step. the step path is ${xpath}`\n\t\t\t\t\t\t);\n\t\t\t\t\t\treturn;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tswitch (step.value) {\n\t\t\tcase 'Enter':\n\t\t\t\tawait page.keyboard.press('Enter');\n\t\t\t\tbreak;\n\t\t\tdefault:\n\t\t\t\tthis.getLogger().log(`keydown [${value}] is not implemented yet.`);\n\t\t\t\tbreak;\n\t\t}\n\t}\n\tprivate async executeMousedownStep(step: MousedownStep): Promise<void> {\n\t\tconst page = await this.getPageOrThrow(step.uuid);\n\t\tconst xpath = this.transformStepPathToXPath(step.path);\n\t\tthis.getLogger().log(`Execute mouse down, step path is ${xpath}`);\n\n\t\tconst element = await this.findElement(step, page);\n\t\tconst support = this.createThirdStepSupport(page, element);\n\t\tconst done = await support.mousedown();\n\n\t\tif (!done) {\n\t\t\tconst currentIndex = this.getCurrentIndex();\n\t\t\tconst currentPath = step.path;\n\t\t\tconst avoidClick = this.getSteps()\n\t\t\t\t.filter((step, index) => index > currentIndex)\n\t\t\t\t.some(step => step.type === 'click' && step.path === currentPath);\n\t\t\tif (avoidClick) {\n\t\t\t\tthis.getLogger().log(`found click for this mousedown, just skip this mousedown`);\n\t\t\t\treturn;\n\t\t\t}\n\t\t\tawait element.click();\n\t\t}\n\t}\n\tprivate async executeAnimationStep(step: AnimationStep): Promise<void> {\n\t\tconst wait = util.promisify(setTimeout);\n\t\tawait wait(step.duration!);\n\t}\n\tprivate async executeScrollStep(step: ScrollStep): Promise<void> {\n\t\tconst page = await this.getPageOrThrow(step.uuid);\n\n\t\tconst scrollTop = step.scrollTop || 0;\n\t\tconst scrollLeft = step.scrollLeft || 0;\n\t\t// this.getLogger().log(scrollTop, scrollLeft);\n\n\t\tif (step.target === 'document') {\n\t\t\tawait page.evaluate(\n\t\t\t\t(scrollTop, scrollLeft) => {\n\t\t\t\t\tdocument.documentElement.scrollTo({ top: scrollTop, left: scrollLeft });\n\t\t\t\t},\n\t\t\t\tscrollTop,\n\t\t\t\tscrollLeft\n\t\t\t);\n\t\t} else {\n\t\t\tconst element = await this.findElement(step, page);\n\t\t\tawait element.evaluate(\n\t\t\t\t(node, scrollTop, scrollLeft) => {\n\t\t\t\t\tnode.scrollTo({ top: scrollTop, left: scrollLeft });\n\t\t\t\t},\n\t\t\t\tscrollTop,\n\t\t\t\tscrollLeft\n\t\t\t);\n\t\t}\n\t}\n\tprivate async executeDialogOpenStep(step: DialogOpenStep): Promise<void> {\n\t\t// dialog open is invoked by javascript anyway, ignore it\n\t\tthis.getLogger().log(`Execute ${step.dialog} open, step url is ${step.url}.`);\n\t}\n\tprivate async executeDialogCloseStep(step: DialogCloseStep): Promise<void> {\n\t\t// dialog close is invoked manually anyway, should be handled in page popup event, ignore it\n\t\tthis.getLogger().log(`Execute ${step.dialog} close, step url is ${step.url}.`);\n\t}\n\tprivate async executeAjaxStep(step: AjaxStep): Promise<void> {\n\t\tthis.getLogger().log(`Execute ajax, step url is ${step.request && step.request.url}.`);\n\t}\n\tprivate async executePageCreatedStep(step: PageCreatedStep): Promise<void> {\n\t\tthis.getLogger().debug(`Execute page created, step url is ${step.url}.`);\n\t\tconst page = this.getPage(step.uuid);\n\t\tif (page) {\n\t\t\t//do nothing\n\t\t\tthis.getLogger().debug(`pop up page created, page uuid is ${step.uuid}.`);\n\t\t} else {\n\t\t\t// TODO really 1s?\n\t\t\tconst sleep = util.promisify(setTimeout);\n\t\t\tawait sleep(1000);\n\t\t\tconst page = this.getPage(step.uuid);\n\t\t\tif (page) {\n\t\t\t\tthis.getLogger().debug(\n\t\t\t\t\t`double check, pop up page created, page uuid is ${step.uuid}.`\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\tthis.getLogger().debug(`To creat pop up page, and add page uuid is ${step.uuid}.`);\n\t\t\t\tconst newPage = await this.browser!.newPage();\n\t\t\t\tif (this.putPage(step.uuid, newPage, false)) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait controlPage(this, newPage, this.device!, step.uuid);\n\t\t\t\t\t\tawait Promise.all([\n\t\t\t\t\t\t\tnewPage.waitForNavigation(), // The promise resolves after navigation has finished\n\t\t\t\t\t\t\tnewPage.goto(step.url!, { waitUntil: 'domcontentloaded' }) // Go to the url will indirectly cause a navigation\n\t\t\t\t\t\t]);\n\t\t\t\t\t} catch {\n\t\t\t\t\t\t// maybe force closed by popup\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tprivate async executePageSwitchedStep(step: PageSwitchStep): Promise<void> {\n\t\tthis.getLogger().debug(`Execute page switched, step url is ${step.url}.`);\n\t\tconst page = this.getPage(step.uuid);\n\t\tif (page) {\n\t\t\t// if query string or hash is different, treat as not changed\n\t\t\t// since sometimes they have random token\n\t\t\tconst url = shorternUrl(page.url());\n\t\t\tconst newUrl = shorternUrl(step.url!);\n\t\t\tif (newUrl !== url) {\n\t\t\t\tconst sleep = util.promisify(setTimeout);\n\t\t\t\tawait sleep(1000);\n\t\t\t\tconst url = shorternUrl(page.url());\n\t\t\t\tif (newUrl !== url) {\n\t\t\t\t\tawait Promise.all([\n\t\t\t\t\t\tpage.waitForNavigation(),\n\t\t\t\t\t\tpage.goto(step.url!, { waitUntil: 'domcontentloaded' })\n\t\t\t\t\t]);\n\t\t\t\t}\n\t\t\t}\n\t\t} else {\n\t\t\t// TODO really 1s?\n\t\t\tconst sleep = util.promisify(setTimeout);\n\t\t\tawait sleep(1000);\n\t\t\tconst page = this.getPage(step.uuid);\n\t\t\tif (page) {\n\t\t\t\t// await page.bringToFront();\n\t\t\t} else {\n\t\t\t\tthis.getLogger().debug(\n\t\t\t\t\t`To creat switched page, and add page uuid is ${step.uuid}.`\n\t\t\t\t);\n\t\t\t\tconst newPage = await this.browser!.newPage();\n\t\t\t\tif (this.putPage(step.uuid, newPage, false)) {\n\t\t\t\t\ttry {\n\t\t\t\t\t\tawait controlPage(this, newPage, this.device!, step.uuid);\n\t\t\t\t\t\tawait Promise.all([\n\t\t\t\t\t\t\tnewPage.waitForNavigation(),\n\t\t\t\t\t\t\tnewPage.goto(step.url!, { waitUntil: 'domcontentloaded' })\n\t\t\t\t\t\t]);\n\t\t\t\t\t} catch {\n\t\t\t\t\t\t// maybe force closed by popup\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tprivate async executePageClosedStep(step: PageClosedStep): Promise<void> {\n\t\tthis.getLogger().debug(`Execute page closed, step url is ${step.url}.`);\n\t\tconst page = this.getPage(step.uuid);\n\t\tif (page) {\n\t\t\tawait page.close();\n\t\t}\n\t}\n\tprivate createThirdStepSupport(page: Page, element: ElementHandle): ThirdStepSupport {\n\t\treturn new ThirdStepSupport({\n\t\t\tpage,\n\t\t\telement,\n\t\t\ttagNameRetrieve: this.createElementTagNameRetriever(),\n\t\t\telementTypeRetrieve: this.createElementTypeRetriever(),\n\t\t\tclassNamesRetrieve: this.createElementClassNamesRetriever(),\n\t\t\tattrValueRetrieve: this.createElementAttrValueRetriever(),\n\t\t\tsteps: this.getSteps(),\n\t\t\tcurrentStepIndex: this.getCurrentIndex(),\n\t\t\tlogger: this.getLogger()\n\t\t});\n\t}\n\tprivate async findElement(step: Step, page: Page): Promise<ElementHandle> {\n\t\tconst xpath = this.transformStepPathToXPath(step.path!);\n\t\tconst elements = await page.$x(xpath);\n\t\tif (elements && elements.length === 1) {\n\t\t\treturn elements[0];\n\t\t}\n\n\t\t// fallback to css path\n\t\tconst csspath = step.csspath;\n\t\tif (csspath) {\n\t\t\tconst count = await page.evaluate(\n\t\t\t\tcsspath => document.querySelectorAll(csspath).length,\n\t\t\t\tcsspath\n\t\t\t);\n\t\t\tif (count === 1) {\n\t\t\t\tconst element = await page.$(csspath);\n\t\t\t\tif (element) {\n\t\t\t\t\treturn element;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst custompath = step.custompath;\n\t\tif (custompath) {\n\t\t\tconst count = await page.evaluate(\n\t\t\t\tcsspath => document.querySelectorAll(csspath).length,\n\t\t\t\tcustompath\n\t\t\t);\n\t\t\tif (count === 1) {\n\t\t\t\tconst element = await page.$(custompath);\n\t\t\t\tif (element) {\n\t\t\t\t\treturn element;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst frames = page.frames();\n\n\t\tif (frames.length > 0) {\n\t\t\tfor (let index = 0; index < frames.length; index++) {\n\t\t\t\tconst frame = frames[index];\n\t\t\t\tconst element = await frame.$x(xpath);\n\t\t\t\tif (element.length === 1) {\n\t\t\t\t\treturn element[0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tconst paths = (() => {\n\t\t\tconst paths = { xpath, csspath, custompath };\n\t\t\treturn Object.keys(paths)\n\t\t\t\t.filter(key => paths[key])\n\t\t\t\t.map(key => `${key}[${paths[key]}]`)\n\t\t\t\t.join(' or ');\n\t\t})();\n\n\t\tthrow new Error(`Cannot find element by ${paths}.`);\n\t}\n\tprivate createElementTagNameRetriever(): ElementRetriever {\n\t\tlet tagName: string;\n\t\treturn async (element: ElementHandle): Promise<string> => {\n\t\t\tif (!tagName) {\n\t\t\t\ttagName = await this.getElementTagName(element);\n\t\t\t}\n\t\t\treturn tagName;\n\t\t};\n\t}\n\tprivate async getElementTagName(element: ElementHandle): Promise<string> {\n\t\treturn await element.evaluate(node => node.tagName);\n\t}\n\tprivate createElementTypeRetriever(): ElementRetriever {\n\t\tlet elementType: string;\n\t\treturn async (element: ElementHandle): Promise<string> => {\n\t\t\tif (!elementType) {\n\t\t\t\telementType = await this.getElementType(element);\n\t\t\t}\n\t\t\treturn elementType;\n\t\t};\n\t}\n\tprivate async getElementType(element: ElementHandle): Promise<string> {\n\t\treturn (await element.evaluate(node => node.getAttribute('type'))) || '';\n\t}\n\tprivate async getElementChecked(element: ElementHandle): Promise<boolean> {\n\t\treturn await element.evaluate((node: Element) => (node as HTMLInputElement).checked);\n\t}\n\tprivate createElementClassNamesRetriever(): ElementRetriever {\n\t\tlet classNames: string;\n\t\treturn async (element: ElementHandle): Promise<string> => {\n\t\t\tif (!classNames) {\n\t\t\t\tclassNames = (await this.getElementAttrValue(element, 'class')) || '';\n\t\t\t}\n\t\t\treturn classNames;\n\t\t};\n\t}\n\tprivate createElementAttrValueRetriever(): ElementAttributeValueRetriever {\n\t\tconst values: { [key in string]: string | null } = {};\n\t\treturn async (element: ElementHandle, attrName: string): Promise<string> => {\n\t\t\tif (!Object.keys(values).includes(attrName)) {\n\t\t\t\tconst value = await this.getElementAttrValue(element, attrName);\n\t\t\t\tif (typeof value === 'undefined') {\n\t\t\t\t\tvalues[attrName] = null;\n\t\t\t\t} else {\n\t\t\t\t\tvalues[attrName] = value;\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn values[attrName]!;\n\t\t};\n\t}\n\tprivate async getElementAttrValue(element: ElementHandle, attrName: string): Promise<string> {\n\t\treturn await element.evaluate((node, attr) => node.getAttribute(attr)!, attrName);\n\t}\n\tprivate async getElementValue(element: ElementHandle): Promise<string> {\n\t\treturn await element.evaluate(\n\t\t\t(node: Element) => (node as HTMLInputElement | HTMLSelectElement).value\n\t\t);\n\t}\n\tprivate async isElementVisible(element: ElementHandle): Promise<boolean> {\n\t\treturn await element.evaluate(\n\t\t\t(node: Element) =>\n\t\t\t\t(node as HTMLElement).offsetWidth > 0 && (node as HTMLElement).offsetHeight > 0\n\t\t);\n\t}\n\tprivate async setValueToElement(element: ElementHandle, value: string) {\n\t\tconst tagName = await this.getElementTagName(element);\n\n\t\t// console.log(\"tagName\", tagName)\n\t\tif (tagName === 'INPUT' || tagName === 'TEXTAREA') {\n\t\t\tconst type = await this.getElementType(element);\n\t\t\tif (\n\t\t\t\t!type ||\n\t\t\t\t['text', 'password', 'url', 'search', 'email', 'hidden', 'number', 'tel'].includes(\n\t\t\t\t\ttype.toLowerCase()\n\t\t\t\t)\n\t\t\t) {\n\t\t\t\t// sometimes key event was bound in input\n\t\t\t\t// force trigger change event cannot cover this scenario\n\t\t\t\t// in this case, as the following steps\n\t\t\t\t// 1. force clear input value\n\t\t\t\t// 2. invoke type\n\t\t\t\t// 3. force trigger change event\n\t\t\t\tawait element.evaluate((node: Element) => ((node as HTMLInputElement).value = ''));\n\t\t\t\tawait element.type(value);\n\t\t\t\tawait element.evaluate(node => {\n\t\t\t\t\t// node.value = value;\n\t\t\t\t\tconst event = document.createEvent('HTMLEvents');\n\t\t\t\t\tevent.initEvent('change', true, true);\n\t\t\t\t\tnode.dispatchEvent(event);\n\t\t\t\t});\n\t\t\t\treturn;\n\t\t\t}\n\t\t}\n\n\t\t// other\n\t\tawait element.evaluate((node: Element, value) => {\n\t\t\tconst element = node as HTMLInputElement;\n\t\t\tif (\n\t\t\t\t!['checkbox', 'radio'].includes(\n\t\t\t\t\t(element.getAttribute('type') || '').toLowerCase()\n\t\t\t\t) ||\n\t\t\t\telement.value != value\n\t\t\t) {\n\t\t\t\telement.value = value;\n\t\t\t\tconst event = document.createEvent('HTMLEvents');\n\t\t\t\tevent.initEvent('change', true, true);\n\t\t\t\tnode.dispatchEvent(event);\n\t\t\t}\n\t\t}, value);\n\t}\n\tprivate transformStepPathToXPath(stepPath: string): string {\n\t\treturn stepPath.replace(/\"/g, \"'\");\n\t}\n}\n\nexport default Replayer;\n"]}